<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recipe Keeper</title>
  <meta name="theme-color" content="#ffffff" />
  <link rel="stylesheet" href="styles.css" />
  <!-- Google API Loader -->
  <script src="https://apis.google.com/js/api.js" async defer></script>
</head>
<body>
  <!-- Password Lock (local-only) -->
  <div id="lock" class="lock">
    <div class="lock-box card">
      <h2>Unlock Recipe Keeper</h2>
      <p class="muted small">This protects only this device. Recipes live in your Google Drive.</p>
      <input id="lockInput" type="password" placeholder="Enter password" />
      <div class="actions">
        <button id="unlockBtn" class="btn primary">Unlock</button>
        <button id="setPassBtn" class="btn">Set/Change password</button>
      </div>
      <div id="lockMsg" class="muted small"></div>
    </div>
  </div>

  <header class="topbar">
    <div class="brand">Recipe Keeper</div>
    <input id="q" type="search" placeholder="Search title, ingredients, notes" />
    <div class="right">
      <button id="addBtn" class="btn">+ New</button>
      <span id="syncStatus" class="chip">Offline</span>
      <label class="toggle"><input type="checkbox" id="themeToggle" /> <span>Dark</span></label>
    </div>
  </header>

  <main>
    <!-- Drive Setup -->
    <section id="driveSetupCard" class="card">
      <div class="row">
        <div class="grow">
          <h3>Google Drive setup</h3>
          <label>CLIENT_ID</label>
          <input id="clientId" placeholder="1234567890-xxxx.apps.googleusercontent.com" />
          <label>API_KEY</label>
          <input id="apiKey" placeholder="AIza..." />
          <div class="actions">
            <button id="connectBtn" class="btn primary">Connect</button>
            <button id="signOutBtn" class="btn">Sign out</button>
          </div>
          <div id="driveMsg" class="muted small"></div>
          <div class="muted small">Add your site URL to OAuth “Authorized JavaScript origins”.</div>
        </div>
        <div class="grow">
<pre class="kbd">/RecipeKeeper/
  ├── recipes.json
  └── images/</pre>
          <div class="muted small">Sync runs at Save and on app start.</div>
        </div>
      </div>
    </section>

    <!-- Toolbar -->
    <section class="card">
      <div class="wrap">
        <div id="catBar" class="wrap"></div>
        <div class="right wrap">
          <button id="manageCatsBtn" class="btn">Manage categories</button>
          <button id="settingsBtn" class="btn">Settings</button>
          <button id="exportBtn" class="btn">Export</button>
          <label for="importFile" class="btn">Import</label>
          <input id="importFile" type="file" accept="application/json" class="hidden" />
        </div>
      </div>
      <div class="muted small">Private: cached locally + synced to your Google Drive.</div>
    </section>

    <!-- Editor -->
    <section id="editor" class="card hidden">
      <h2 id="formTitle" class="h2">New recipe</h2>
      <div class="row">
        <div class="grow">
          <label>Title</label><input id="title" />
          <label>Category</label><select id="category"></select>
          <label>Prep time</label><input id="prep" />
          <label>Ingredients (one per line)</label><textarea id="ingredients"></textarea>
          <label>Steps (one per line)</label><textarea id="steps"></textarea>
          <label>Notes</label><textarea id="notes"></textarea>

          <div class="actions">
            <input id="imgInput" type="file" accept="image/*" class="hidden" />
            <button id="uploadImgBtn" class="btn">Upload image</button>
            <span id="uploadStatus" class="muted small"></span>
          </div>

          <label>Photo URL (optional)</label><input id="photo" />
          <div class="actions">
            <button id="cancelBtn" class="btn">Cancel</button>
            <button id="saveBtn" class="btn primary">Save</button>
          </div>
        </div>

        <div class="grow">
          <div class="muted">Preview</div>
          <div id="preview"></div>
        </div>
      </div>
    </section>

    <!-- List -->
    <section id="list" class="grid"></section>
    <div class="footer">Tip: Add to Home Screen for app-like use.</div>
  </main>

  <!-- Category manager -->
  <dialog id="catDlg">
    <div class="dlg-h">Manage categories</div>
    <div class="dlg-b">
      <div class="wrap">
        <input id="newCatName" placeholder="New category name" class="grow" />
        <button id="addCatBtn" class="btn">Add</button>
      </div>
      <div id="catList" class="vpad"></div>
      <div class="actions end">
        <button id="closeCatDlg" class="btn">Close</button>
      </div>
      <div class="muted small">Rename/delete only when unused by any recipe.</div>
    </div>
  </dialog>

  <!-- Settings -->
  <dialog id="settingsDlg">
    <div class="dlg-h">Settings</div>
    <div class="dlg-b">
      <div class="muted small">Password is <b>local to this device</b> (not synced). Clear browser data to remove it.</div>
      <label>New password</label>
      <input id="newPass" type="password" placeholder="Enter new password" />
      <div class="actions">
        <button id="savePassBtn" class="btn primary">Save password</button>
        <button id="closeSettings" class="btn">Close</button>
      </div>
      <div id="settingsMsg" class="muted small"></div>
    </div>
  </dialog>

  <!-- App script -->
  <script src="app.js" defer></script>

  <!-- Debug: show JS errors if any -->
  <script>
    window.onerror = (m, s, l) => alert("JS Error → " + m + "\n" + (s||"") + ":" + (l||""));
  </script>
</body>
</html>
