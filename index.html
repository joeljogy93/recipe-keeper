<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recipe Keeper</title>
  <meta name="theme-color" content="#ffffff" />
  <link rel="stylesheet" href="styles.css" />
  <!-- Google API loader -->
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <!-- Password Lock (local-only) -->
  <div id="lock" class="lock">
    <div class="lock-box">
      <h3 id="lockTitle">Unlock Recipe Keeper</h3>
      <p class="muted small" id="lockHint">This protects only this device. Data lives in your Google Drive.</p>
      <input id="lockInput" type="password" placeholder="Enter password" />
      <div class="actions">
        <button id="unlockBtn" class="btn primary">Unlock</button>
        <button id="setPassBtn" class="btn">Set/Change password</button>
      </div>
      <div id="lockMsg" class="muted small"></div>
    </div>
  </div>

  <!-- App -->
  <div id="app" class="hidden">
    <header class="bar">
      <h1>Recipe Keeper</h1>
      <div class="right">
        <label class="switch"><input type="checkbox" id="darkToggle"><span>Dark</span></label>
      </div>
    </header>

    <section class="card">
      <h3>Google Drive setup</h3>
      <div class="row">
        <label>CLIENT_ID</label>
        <input id="clientId" placeholder="Your OAuth 2.0 Web Client ID" />
      </div>
      <div class="row">
        <label>API_KEY</label>
        <input id="apiKey" placeholder="Your API key" />
      </div>
      <div class="row">
        <button id="connectBtn" class="btn primary">Connect</button>
        <button id="signoutBtn" class="btn">Sign out</button>
      </div>
      <p class="muted small">
        Add your site URL to OAuth “Authorized JavaScript origins”.<br/>
        Folder structure:
      </p>
      <pre class="tree">/RecipeKeeper/
  ├─ recipes.json
  └─ images/</pre>
      <p id="driveMsg" class="muted small"></p>
    </section>

    <section class="bar">
      <input id="search" class="search" placeholder="Search title, ingredients, note" />
      <button id="newBtn" class="btn">+ New</button>
      <button id="manageBtn" class="btn">Manage categories</button>
      <button id="settingsBtn" class="btn">Settings</button>
    </section>

    <section id="list" class="list"></section>

    <!-- New / Edit dialog -->
    <dialog id="editDlg">
      <div class="dlg-h"><span id="dlgTitle">New recipe</span></div>
      <div class="dlg-b">
        <label>Title</label>
        <input id="rTitle" />
        <label>Category</label>
        <select id="rCategory"></select>
        <label>Ingredients (one per line)</label>
        <textarea id="rIngr" rows="6"></textarea>
        <label>Steps / Notes</label>
        <textarea id="rNotes" rows="6"></textarea>
        <label>Photo</label>
        <input id="rImage" type="file" accept="image/*" />
        <img id="rImagePreview" class="preview hidden" />
        <div class="actions">
          <button id="saveBtn" class="btn primary">Save</button>
          <button id="deleteBtn" class="btn danger">Delete</button>
          <button id="closeBtn" class="btn">Close</button>
        </div>
        <div id="editMsg" class="muted small"></div>
      </div>
    </dialog>

    <!-- Categories dialog -->
    <dialog id="catsDlg">
      <div class="dlg-h">Categories</div>
      <div class="dlg-b">
        <ul id="catsList" class="chips"></ul>
        <div class="row">
          <input id="newCat" placeholder="New category name" />
          <button id="addCatBtn" class="btn">Add</button>
        </div>
        <p class="muted small">Tap a chip to delete.</p>
        <div class="actions">
          <button id="closeCats" class="btn">Close</button>
        </div>
      </div>
    </dialog>

    <!-- Settings dialog -->
    <dialog id="settingsDlg">
      <div class="dlg-h">Settings</div>
      <div class="dlg-b">
        <div class="muted small">Password is <b>local to this device</b> (not synced).</div>
        <label>New password</label>
        <input id="newPass" type="password" placeholder="Enter new password" />
        <div class="actions">
          <button id="savePassBtn" class="btn primary">Save password</button>
          <button id="closeSettings" class="btn">Close</button>
        </div>
        <div id="settingsMsg" class="muted small"></div>
      </div>
    </dialog>
  </div>

  <!-- App scripts (no modules) -->
  <script src="drive.js" defer></script>
  <script src="app.js" defer></script>

  <!-- Tiny helper: surface JS errors on mobile -->
  <script>
    window.onerror = (m,s,l) => alert("JS Error → " + m + "\n" + s + ":" + l);
  </script>
</body>
</html>
